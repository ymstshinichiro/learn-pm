-- 現場型プロジェクトマネジメントコース: レッスン5
-- 品質確保のための標準化と検査プロセス

DO $$
DECLARE
  v_course_id INT;
  v_lesson_id INT;
BEGIN
  -- コースIDを取得
  SELECT id INTO v_course_id FROM courses WHERE slug = 'field-pm';

  -- レッスン5を挿入
  INSERT INTO lessons (course_id, slug, title, content, "order", created_at)
  VALUES (
    v_course_id,
    'quality-standardization-inspection',
    '品質確保のための標準化と検査プロセス',
    $CONTENT$# 品質確保のための標準化と検査プロセス

## 📋 このレッスンで学ぶこと

品質は現場の信頼の源です。本レッスンでは、品質を確保するための標準化、検査プロセス、不具合管理、そして品質コストの考え方を実践的に学びます。

---

## 🎯 品質管理の基本

### 品質とは

**品質の定義**: 「顧客要求を満たす度合い」

| 品質の側面 | 意味 | 確保方法 |
|----------|------|---------|
| **設計品質** | 設計仕様の妥当性 | 顧客との擦り合わせ、設計レビュー |
| **適合品質** | 設計通りに作られているか | 工程管理、検査 |
| **使用品質** | 実際の使用に耐えるか | 性能試験、耐久試験 |

### QCとQA

| 用語 | 意味 | アプローチ |
|-----|------|----------|
| **QC** (Quality Control) | 品質管理 | 検査、測定、不良品の選別（対症療法） |
| **QA** (Quality Assurance) | 品質保証 | 標準化、プロセス改善、予防措置（予防医療） |

**重要**: QCだけでは不十分。QAで「不良を作らない仕組み」を作る。

---

## 📏 標準化の実践

### 標準化の目的

1. **品質の安定**: 誰がやっても同じ品質
2. **効率化**: ムダな試行錯誤を排除
3. **教育の容易化**: 新人もすぐに習得
4. **改善の基盤**: 標準があって初めて改善できる

### 標準作業手順書（SOP）の作成

#### SOPに含めるべき内容

```
【作業手順書の構成例】

1. 作業名・目的
2. 適用範囲
3. 使用材料・工具
4. 安全上の注意事項
5. 作業手順（ステップバイステップ）
   - 写真・図解を多用
   - 重要ポイントを明示
6. 品質基準（合格・不合格の判断基準）
7. 記録様式
```

#### 良いSOPの条件

| 条件 | 説明 |
|-----|------|
| **具体的** | 曖昧な表現を避け、数値・具体例を示す |
| **視覚的** | 写真・図解で理解しやすく |
| **実行可能** | 現場で実際に使えるレベルの詳細さ |
| **最新** | 定期的に見直し、改善を反映 |

**悪い例**: 「丁寧に施工する」「十分に乾燥させる」
**良い例**: 「塗布量は1㎡あたり200g」「24時間以上乾燥（気温20℃以上）」

### 標準化の対象

| 対象 | 標準化の内容 |
|-----|------------|
| **材料** | 使用材料の規格、メーカー、グレード |
| **工法** | 施工手順、使用工具、作業条件 |
| **検査** | 検査項目、検査方法、合格基準 |
| **記録** | 記録様式、記録頻度、保管方法 |

---

## 🔍 検査プロセス

### 検査の種類

| 検査分類 | タイミング | 目的 |
|---------|----------|------|
| **受入検査** | 材料・資材の納品時 | 不良品の混入防止 |
| **工程内検査** | 各工程完了時 | 不良の早期発見、次工程への品質保証 |
| **中間検査** | 主要工程完了時 | マイルストーンでの品質確認 |
| **最終検査** | 全作業完了時 | 引渡し前の総合チェック |

### 検査の方法

#### 1. 全数検査

**内容**: すべての製品・箇所を検査

**用途**: 重要部位、少量生産

**メリット**: 不良を完全に排除

**デメリット**: コスト・時間がかかる

#### 2. 抜き取り検査

**内容**: サンプル抽出して検査、ロット全体を判定

**用途**: 大量生産、均質な製品

**メリット**: 効率的

**デメリット**: 不良を見逃すリスク

#### 3. 破壊検査

**内容**: 製品を破壊して強度等を確認

**用途**: コンクリート圧縮試験、溶接試験

**メリット**: 正確な品質確認

**デメリット**: 製品が使えなくなる

#### 4. 非破壊検査

**内容**: 製品を壊さずに内部欠陥を検出

**用途**: 溶接部（X線、超音波）、配管（漏れ試験）

**メリット**: 製品を保持、全数検査可能

### 検査記録の重要性

**記録の目的**:
- トレーサビリティ（いつ・誰が・何を検査したか）
- 問題発生時の原因究明
- 顧客への品質証明

**記録様式例**:
```
【検査記録表】
- 検査日時
- 検査箇所・項目
- 検査方法
- 判定基準
- 検査結果（数値、合否）
- 検査者氏名
- 立会者氏名（顧客・第三者）
```

---

## 📸 写真管理

### 工事写真の目的

1. **施工記録**: 後で見えなくなる部分の記録
2. **品質証明**: 仕様通りに施工したことの証明
3. **トラブル時の証拠**: 紛争時の客観的証拠

### 撮影のポイント

| ポイント | 内容 |
|---------|------|
| **黒板の使用** | 工事名、日付、箇所、工程を明示 |
| **全体と詳細** | 全体像と重要部のクローズアップ |
| **段階ごと** | 着手前 → 施工中 → 完成 |
| **寸法の明示** | スケール（メジャー）を写し込む |

**撮影必須のタイミング**:
- 基礎・配筋（コンクリート打設前）
- 配管・配線（埋設前）
- 防水処理（仕上げ前）
- 検査・試験の実施状況

---

## ❌ 不具合管理

### 不具合の分類

| 分類 | 内容 | 対応 |
|-----|------|------|
| **軽微** | 性能に影響なし、見た目のみ | 記録、手直し検討 |
| **中程度** | 性能に若干影響、補修可能 | 補修、再検査 |
| **重大** | 性能に重大な影響、やり直し必要 | 原因究明、再施工 |

### 不具合対応のプロセス

```
1. 発見・記録
   ↓
2. 原因分析（なぜなぜ分析）
   ↓
3. 是正措置（今回の対処）
   ↓
4. 予防措置（再発防止）
   ↓
5. 水平展開（他の現場にも共有）
```

### なぜなぜ分析の例

```
【不具合】
コンクリートにひび割れが発生

なぜ1: なぜひび割れが発生したのか？
→ 乾燥が早すぎた

なぜ2: なぜ乾燥が早すぎたのか？
→ 養生が不十分だった

なぜ3: なぜ養生が不十分だったのか？
→ 養生シートが足りず、一部養生できなかった

なぜ4: なぜ養生シートが足りなかったのか？
→ 材料発注が不足していた

なぜ5: なぜ発注が不足したのか？
→ 作業面積の計算ミス、チェック体制がなかった

【根本原因】
材料発注のダブルチェック体制がない

【対策】
1. 是正措置: ひび割れ部分を補修
2. 予防措置: 材料発注時のダブルチェック体制を構築
3. 水平展開: 全現場に発注チェック体制を導入
```

---

## 💰 品質コスト

### 品質コストの構造

```
【適合コスト（品質確保のコスト）】
- 予防コスト: 標準化、教育、設計レビュー
- 評価コスト: 検査、試験、測定機器

【不適合コスト（品質不良のコスト）】
- 内部失敗コスト: 手戻り、スクラップ、再検査
- 外部失敗コスト: 瑕疵対応、クレーム処理、信用失墜

※ 外部失敗コストは内部の10倍以上
```

### 最適な品質投資

```
コスト
 │     総コスト
 │      ╱ ＼
 │    ╱     ＼
 │  ╱不適合   ＼
 │╱  コスト      ＼
 │                 ＼
 │    適合コスト      ＼
 └────────────────→ 品質レベル
      最適点
```

**教訓**:
- 過少投資: 不良多発、不適合コスト増
- 過剰投資: 過剰品質、適合コスト増
- 最適投資: 総コスト最小化

---

## 🏆 品質文化の醸成

### 品質第一の文化

❌ **悪い文化**:
- 「品質より工期」
- 「検査は面倒」
- 「これくらい大丈夫」

✅ **良い文化**:
- 「品質は全員の責任」
- 「不良を次工程に流さない」
- 「疑問があれば即座に確認」

### 品質意識を高める施策

| 施策 | 内容 |
|-----|------|
| **見える化** | 品質目標、検査結果、不具合件数を掲示 |
| **表彰制度** | 品質優良者・チームを表彰 |
| **品質教育** | 定期的な勉強会、ベテランのノウハウ共有 |
| **小集団活動** | QCサークル、改善提案 |

---

## ⚠️ よくある失敗パターン

### 失敗パターン1: 検査の形骸化

**症状**: チェックリストに✓だけ、実際は見ていない

**原因**: 時間がない、形式的な対応

**対策**: 検査項目の絞り込み、重点検査

### 失敗パターン2: 標準の陳腐化

**症状**: 作業手順書が古く、現場と乖離

**原因**: 更新されない、改善が反映されない

**対策**: 定期レビュー、改善提案の仕組み

### 失敗パターン3: 過剰品質

**症状**: 顧客要求を超える品質、コスト増

**原因**: 「良いものを作りたい」職人気質

**対策**: 顧客要求の明確化、コスト意識

---

## 🎓 まとめ

品質は「作り込む」ものであり、「検査で選別する」ものではありません。

### 成功のための5つのポイント

1. **標準化**: 誰がやっても同じ品質を実現
2. **工程内検査**: 不良を次工程に流さない
3. **記録の徹底**: トレーサビリティの確保
4. **予防志向**: 不良を作らない仕組み（QA）
5. **品質文化**: 全員が品質を意識

「品質は無料」— 品質確保のコストは、不良対応のコストより遥かに安い。
$CONTENT$,
    5,
    NOW()
  ) RETURNING id INTO v_lesson_id;

  -- レッスン5の質問を挿入
  INSERT INTO questions (lesson_id, type, question, options, correct_answer, explanation, "order", created_at)
  VALUES
    (v_lesson_id, 'multiple-choice', 'QC（品質管理）とQA（品質保証）の関係について、最も適切な説明はどれですか？',
     ARRAY['QCは検査・測定で不良を選別する対症療法、QAは標準化・プロセス改善で不良を作らない予防措置であり、両方必要',
           'QCとQAは同じ意味で、どちらも品質を確保するための検査活動を指す',
           'QCは現場レベルの活動、QAは経営層の活動であり、役割が明確に分かれている',
           'QAがあればQCは不要で、予防措置だけで品質は確保できる'],
     ARRAY['QCは検査・測定で不良を選別する対症療法、QAは標準化・プロセス改善で不良を作らない予防措置であり、両方必要'],
     'Bは誤りで、QCとQAは異なる概念です。Cは誤りで、現場・経営層の区別ではなく、アプローチの違いです。Dは誤りで、QAだけでは不十分で、検査（QC）も必要です。Aが正解で、QCは「不良を見つけて選別する」対症療法的アプローチ、QAは「不良を作らない仕組みを作る」予防的アプローチです。理想はQAで不良を減らし、QCで最終確認する組み合わせです。検査だけでは限界があり、標準化・教育・プロセス改善により「そもそも不良が発生しにくい環境」を作ることが品質保証の本質です。',
     1, NOW()),

    (v_lesson_id, 'multiple-choice', '標準作業手順書（SOP）に記載する内容として、最も不適切なのはどれですか？',
     ARRAY['「塗布量は1㎡あたり200g、塗布後24時間以上乾燥（気温20℃以上）」のように具体的な数値と条件を記載',
           '「丁寧に施工する」「十分に乾燥させる」のように作業員の判断に委ねる表現',
           '写真や図解を多用し、視覚的に理解しやすくする',
           '安全上の注意事項、使用材料・工具、品質基準（合格・不合格の判断基準）を明記'],
     ARRAY['「丁寧に施工する」「十分に乾燥させる」のように作業員の判断に委ねる表現'],
     'A、C、Dはすべて良いSOPの条件です。Bが不適切で、「丁寧に」「十分に」といった曖昧な表現は、人によって解釈が異なり、品質のばらつきを生みます。SOPの目的は「誰がやっても同じ品質」を実現することであり、そのためには具体的な数値・条件（塗布量200g/㎡、乾燥24時間以上、気温20℃以上等）が必要です。曖昧な表現は標準化の意味をなさず、ベテランと新人で品質が変わってしまいます。SOPは「具体的・視覚的・実行可能」であることが鉄則です。',
     2, NOW()),

    (v_lesson_id, 'multiple-choice', 'コンクリートの配筋工事で、鉄筋の配置が完了した。次にコンクリートを打設する予定だが、検査のタイミングとして最も適切なのはどれですか？',
     ARRAY['コンクリート打設後、硬化してから配筋状況を確認する（最終検査）',
           'コンクリート打設直前に配筋状況を検査し、写真記録を残す（工程内検査）',
           'すべての工事完了後、引渡し前に総合的に検査する（最終検査）',
           '配筋工事は専門業者に任せているため、検査は不要'],
     ARRAY['コンクリート打設直前に配筋状況を検査し、写真記録を残す（工程内検査）'],
     'Aは誤りで、コンクリート打設後は配筋が見えなくなり、不良があっても確認・是正できません。Cは誤りで、最終検査では配筋は既に埋まっており、確認不可能です。Dは誤りで、専門業者に任せても発注者側の検査責任は残ります。Bが正解で、配筋はコンクリート打設後に見えなくなる「隠蔽部」であり、打設前に検査・写真記録が必須です。この「工程内検査」により、不良を次工程（打設）に流さず、手戻りを防ぎます。現場の鉄則は「見えなくなる前に確認」です。',
     3, NOW()),

    (v_lesson_id, 'multiple-answer', '品質不良が発生した際の対応プロセスとして適切なものはどれですか？（複数選択）',
     ARRAY['不具合を発見・記録し、なぜなぜ分析で根本原因を特定する',
           '今回の不具合を是正措置で対処し、再発防止のための予防措置を講じる',
           '責任者を特定し、個人の責任として処分することで再発を防ぐ',
           '同様の不具合が他の現場でも起きないよう、水平展開で情報共有・対策を実施する'],
     ARRAY['不具合を発見・記録し、なぜなぜ分析で根本原因を特定する', '今回の不具合を是正措置で対処し、再発防止のための予防措置を講じる', '同様の不具合が他の現場でも起きないよう、水平展開で情報共有・対策を実施する'],
     'A、B、Dが正解です。Aのように不具合を記録し、なぜなぜ分析（5回のなぜ）で根本原因を特定することが、再発防止の第一歩です。Bのように是正措置（今回の対処）と予防措置（再発防止の仕組み）の両方が必要です。Dの水平展開により、他の現場でも同じ問題を防げます。Cは誤りで、個人を責めても問題は解決せず、報告を隠す文化を生みます。不具合対応の本質は「個人ではなくシステムの問題として扱い、仕組みで再発を防ぐ」ことです。',
     4, NOW()),

    (v_lesson_id, 'multiple-choice', '品質コストの観点から、最も費用対効果が高い品質投資はどれですか？',
     ARRAY['検査を徹底し、不良品を確実に選別して次工程に流さないようにする（評価コスト）',
           '不良が顧客に届いた場合に備え、瑕疵対応の予算を多めに確保する（外部失敗コスト）',
           '標準化・教育・設計レビューにより、そもそも不良を作らない仕組みを作る（予防コスト）',
           '高品質な材料を使用し、顧客要求を超える品質を実現する（過剰品質）'],
     ARRAY['標準化・教育・設計レビューにより、そもそも不良を作らない仕組みを作る（予防コスト）'],
     'Aの検査徹底（評価コスト）は重要ですが、不良を作ってから選別するため、スクラップや手戻りのコストが発生します。Bの瑕疵対応予算確保（外部失敗コスト）は最も高コストで、信用失墜も伴います。Dの過剰品質は顧客要求を超えており、無駄なコスト増です。Cが正解で、予防コスト（標準化、教育、設計レビュー）は、不良を「作らない」ため、評価コストや失敗コストを大幅に削減できます。品質コストの原則は「予防 < 評価 << 内部失敗 <<< 外部失敗」の順でコストが跳ね上がることであり、予防投資が最も費用対効果が高いです。',
     5, NOW());

END $$;
