-- 現場型プロジェクトマネジメントコース
-- 工期・品質・安全・コストのバランスを取る

-- コースを挿入
INSERT INTO courses (slug, title, category, description, is_public, created_at)
VALUES (
  'field-pm',
  '工期・品質・安全・コストのバランスを取る現場型プロジェクトマネジメント',
  '建設・製造・現場管理',
  '建設、製造、設備保守などの現場で求められるプロジェクトマネジメントの実践手法を学びます。工期・品質・安全・コストの4大管理をバランスよく実現し、トラブル対応や改善活動まで、現場リーダーに必要な総合的なマネジメントスキルを習得できます。',
  0,
  NOW()
);

-- レッスン1: 現場型プロジェクトマネジメントの基本概念と特徴
DO $$
DECLARE
  v_course_id INT;
  v_lesson_id INT;
BEGIN
  -- コースIDを取得
  SELECT id INTO v_course_id FROM courses WHERE slug = 'field-pm';

  -- レッスン1を挿入
  INSERT INTO lessons (course_id, slug, title, content, "order", created_at)
  VALUES (
    v_course_id,
    'field-pm-basics',
    '現場型プロジェクトマネジメントの基本概念と特徴',
    $CONTENT$# 現場型プロジェクトマネジメントの基本概念と特徴

## 📋 このレッスンで学ぶこと

現場型プロジェクトマネジメントは、建設、製造、設備保守などの「現場」で実施されるプロジェクトに特化したマネジメント手法です。IT・ソフトウェア開発とは異なる特性を理解し、工期・品質・安全・コストの4大管理をバランスよく実現する基本的な考え方を学びます。

---

## 🎯 現場型プロジェクトの特徴

### ITプロジェクトとの違い

| 観点 | 現場型プロジェクト | ITプロジェクト |
|-----|------------------|---------------|
| **成果物** | 物理的（建物、設備、製品） | デジタル（ソフトウェア、システム） |
| **変更容易性** | 低い（やり直しに大きなコスト） | 比較的高い（コード修正可能） |
| **安全管理** | 最優先（人命に直結） | 情報セキュリティが中心 |
| **作業環境** | 屋外・現場中心 | オフィス・リモート可能 |
| **天候影響** | 大きい（工期に直結） | ほぼなし |
| **リソース** | 設備・資材・職人技能 | 人材・サーバー・ライセンス |
| **検査タイミング** | 工程ごと（後戻り困難） | 継続的（自動テスト可能） |

### 現場型プロジェクトの本質的特徴

#### 1. **不可逆性が高い**

一度施工・製造したものを元に戻すのは、コストと時間が膨大にかかります。

**例**:
- 建築で基礎工事を完了後、位置変更は事実上不可能
- 製造ラインの設置後、レイアウト変更は大規模工事
- 配管工事の埋設後、ルート変更は全面やり直し

**対策**: 事前の入念な計画・設計レビュー・段階的検査が必須

#### 2. **安全が最優先**

現場作業は常に危険と隣り合わせです。事故は人命に関わり、プロジェクトの中断、企業の信用失墜につながります。

**労働災害の主な原因**:
- 墜落・転落（高所作業）
- 挟まれ・巻き込まれ（機械作業）
- 感電（電気工事）
- 崩壊・倒壊（掘削・足場）

**原則**: 「安全第一、品質第二、工期第三」

#### 3. **天候・環境の影響を受ける**

屋外作業は天候に左右され、計画通りに進まないことが常態です。

**影響例**:
- 雨天で土木・塗装作業が中止
- 強風で高所作業・クレーン作業が不可
- 猛暑・厳寒で作業効率低下、熱中症・凍結リスク
- 台風・大雪で長期中断

**対策**: 天候バッファの確保、代替工程の準備

#### 4. **多様な職種・協力会社の連携**

現場は多数の専門業者（職種）が時間差で作業します。

**建設現場の例**:
```
基礎工事（土木） → 躯体工事（鉄筋・型枠・コンクリート） →
内装工事（電気・配管・空調・内装仕上げ） → 外構工事
```

**課題**:
- 前工程の遅延が後工程に波及（クリティカルパス）
- 業者間の責任範囲の曖昧さ（取り合い部分）
- コミュニケーション不足による手戻り

---

## 💡 4大管理の概要

現場型プロジェクトマネジメントの中心は、**工期・品質・コスト・安全**の4つを同時にマネジメントすることです。

### 1. **工期管理（Time Management）**

**目的**: 納期を守り、顧客との約束を果たす

**管理手法**:
- ガントチャート、工程表でスケジュール可視化
- クリティカルパスの把握（遅延が全体に影響する工程）
- 日次・週次の進捗確認と遅延対策

**KPI例**:
- 工程達成率（計画vs実績）
- 遅延日数
- マイルストーン達成状況

### 2. **品質管理（Quality Management）**

**目的**: 設計通りの性能・仕様を実現し、顧客満足を得る

**管理手法**:
- 標準作業手順書（SOP）の整備
- 工程ごとの検査・承認プロセス
- 不具合の記録と是正措置

**KPI例**:
- 検査合格率
- 不具合件数
- 手戻り工数

### 3. **コスト管理（Cost Management）**

**目的**: 予算内で完遂し、利益を確保する

**管理手法**:
- 実行予算の策定と原価管理
- 日々の出来高と原価の把握
- 予実管理と差異分析

**KPI例**:
- 原価率（実績原価/売上）
- 予算差異（計画vs実績）
- 粗利益率

### 4. **安全管理（Safety Management）**

**目的**: 労働災害ゼロ、作業員の安全確保

**管理手法**:
- リスクアセスメント（危険源の特定と対策）
- 安全教育・朝礼でのKY活動（危険予知）
- 安全パトロールと是正指示

**KPI例**:
- 無災害日数
- ヒヤリハット報告件数
- 安全パトロール指摘件数

---

## 📊 4大管理のトレードオフ関係

4つの管理は、互いに影響し合います。一つを優先すると、他が犠牲になるトレードオフが存在します。

### トレードオフの典型例

| 優先事項 | 影響 | 結果 |
|---------|------|------|
| **工期短縮** | 残業・休日出勤増加 → コスト増、安全リスク増 | 納期は守れるが利益減、事故リスク |
| **コスト削減** | 安価な資材・未熟な作業員 → 品質低下、作業時間増 | 利益は出るが品質問題、工期遅延 |
| **品質重視** | 入念な検査・手直し → 工期延長、コスト増 | 品質は良いが納期遅れ、予算超過 |
| **安全重視** | 安全対策・教育に時間 → 工期延長、コスト増 | 事故ゼロだが納期・予算に影響 |

### バランスの取り方

**鉄則**: 安全は譲れない。その上で、品質・工期・コストの優先順位を明確にする。

**優先順位の決定要因**:
1. **契約条件**: 納期厳守条項、品質保証条項、ペナルティの有無
2. **顧客ニーズ**: 何を最も重視しているか（品質・納期・価格）
3. **企業方針**: 品質第一主義、安全最優先、収益性重視
4. **プロジェクト特性**: 初物案件（品質重視）、定型案件（コスト重視）

**実践例**:
```
【病院建設プロジェクト】
優先順位: 安全 > 品質 > 工期 > コスト
理由: 人命を預かる施設であり、品質妥協は許されない。
開院日は調整可能だが、品質不良は訴訟リスク。

【商業施設改装プロジェクト】
優先順位: 安全 > 工期 > コスト > 品質
理由: 開店日が決まっており（広告済み）、工期遅延は機会損失大。
品質は最低限クリアすれば良く、コストも多少超過OK。
```

---

## 🏗️ 現場型プロジェクトのライフサイクル

### 1. 計画フェーズ

**活動**:
- 顧客要件のヒアリングと仕様確定
- 現地調査（敷地条件、既存設備確認）
- 実行予算の策定（資材・労務費・外注費）
- 工程表の作成（ガントチャート）
- 安全計画・品質計画の策定

**成果物**:
- 施工計画書
- 実行予算書
- 工程表
- 安全計画書、品質管理計画書

### 2. 実行フェーズ

**活動**:
- 着工前準備（資材手配、職人手配、仮設設置）
- 施工管理（日々の進捗管理、品質検査、安全パトロール）
- 変更管理（設計変更、追加工事の対応）
- 定例会議（週次工程会議、月次報告）

**日常業務**:
- 朝礼（安全唱和、本日の作業内容・注意事項共有）
- 現場巡回（進捗確認、安全確認、品質確認）
- 写真記録（工程写真、検査写真）
- 日報作成（作業内容、人工数、材料使用量）

### 3. 完了・引渡しフェーズ

**活動**:
- 最終検査（社内検査、顧客検査、第三者検査）
- 不具合の是正（手直し工事）
- 竣工図書の作成（as-built 図面、取扱説明書）
- 引き渡しと顧客教育（操作方法、メンテナンス方法）

**成果物**:
- 竣工図
- 検査記録
- 取扱説明書、保証書

### 4. 保守・アフターフォローフェーズ

**活動**:
- 定期点検（保証期間中の無償点検）
- 不具合対応（瑕疵対応）
- 顧客満足度調査

---

## 📈 現場マネジメントの成功要因

### 1. **計画の精度**

「段取り八分」— 事前準備が成否の8割を決める

**重要な計画要素**:
- 詳細な工程計画（日単位の作業計画）
- 現実的な予算（過去実績ベースの積算）
- リスク対策の事前準備（天候・資材調達遅延）

### 2. **現場の見える化**

現場の状況をリアルタイムで把握し、問題を早期発見

**見える化の手法**:
- 工程表の現場掲示（全員が進捗を把握）
- 安全掲示板（無災害日数、KY活動結果）
- 品質管理ボード（検査結果、不具合状況）

### 3. **コミュニケーションの質**

多様な職種・協力会社との連携がカギ

**効果的な手法**:
- 朝礼での情報共有
- 工程会議での調整
- 現場での即時対話（問題発見時にその場で解決）

### 4. **迅速な意思決定**

現場は待ってくれない。問題発生時の素早い判断が被害を最小化

**意思決定のポイント**:
- 現場で判断できる権限委譲
- エスカレーションルールの明確化
- トレードオフの優先順位の共有

---

## ⚠️ よくある失敗パターン

### 失敗パターン1: 計画の甘さ

**症状**: 工期遅延、予算超過、品質不良

**原因**:
- 過去の実績を無視した楽観的な見積もり
- 現地調査不足で想定外の問題が多発
- リスクバッファを確保していない

**対策**:
- 過去の類似案件のデータを活用
- 現地調査を入念に実施
- コンティンジェンシー（予備）を確保（工期10%、コスト5-10%）

### 失敗パターン2: コミュニケーション不足

**症状**: 手戻り、責任の押し付け合い、トラブル頻発

**原因**:
- 図面・仕様書の伝達不足
- 業者間の調整不足（取り合い部分の未調整）
- 報連相の文化がない

**対策**:
- 定例会議の実施（週次工程会議必須）
- 図面の読み合わせ、施工前打ち合わせ
- 報連相のルール化（いつ・誰に・何を報告）

### 失敗パターン3: 安全軽視

**症状**: 労働災害発生、工事中断、企業の信用失墜

**原因**:
- 工期優先で安全対策を省略
- 安全教育の不足
- ヒヤリハットの見逃し

**対策**:
- 安全第一の徹底（工期より安全を優先）
- 定期的な安全教育とKY活動
- ヒヤリハットの報告と対策

---

## 🎓 まとめ

現場型プロジェクトマネジメントは、**安全・品質・工期・コスト**の4大管理をバランスよく実現することが求められます。

### 成功のための5つのポイント

1. **計画の精度を高める**: 過去実績・現地調査に基づく現実的な計画
2. **安全を最優先**: 人命を守ることが全ての前提
3. **見える化**: 進捗・品質・安全を可視化し、問題を早期発見
4. **コミュニケーション**: 多様な職種・協力会社との密な連携
5. **迅速な意思決定**: トレードオフを理解し、優先順位に沿った判断

現場は生き物です。計画通りにいかないことを前提に、柔軟かつ迅速に対応する力が、現場マネージャーに求められます。
$CONTENT$,
    1,
    NOW()
  ) RETURNING id INTO v_lesson_id;

  -- レッスン1の質問を挿入
  INSERT INTO questions (lesson_id, type, question, options, correct_answer, explanation, "order", created_at)
  VALUES
    -- 質問1: 現場型プロジェクトの特徴理解
    (v_lesson_id, 'multiple-choice', '現場型プロジェクト（建設・製造等）とITプロジェクトの最も本質的な違いはどれですか？',
     ARRAY['現場型は屋外作業が中心で天候の影響を受けるが、ITはオフィスやリモートで天候の影響がない',
           '現場型は物理的な成果物で不可逆性が高く、やり直しのコストが極めて大きいが、ITはデジタルで変更が比較的容易',
           '現場型は多数の協力会社との連携が必要だが、ITは自社内で完結することが多い',
           '現場型は安全管理が最優先だが、ITは情報セキュリティが最優先'],
     ARRAY['現場型は物理的な成果物で不可逆性が高く、やり直しのコストが極めて大きいが、ITはデジタルで変更が比較的容易'],
     'A、C、Dはすべて現場型の特徴ですが、表面的な違いです。Bが正解で、最も本質的な違いは「不可逆性」です。現場型では、一度基礎を打設したら位置変更は不可能、配管を埋設したらルート変更は全面やり直しなど、物理的な制約により後戻りが極めて困難です。これに対しITはコードの修正・リファクタリングが可能で、変更容易性が高いです。この不可逆性の高さが、現場型プロジェクトで「事前の入念な計画」「段階的検査」が絶対に必要な理由です。',
     1, NOW()),

    -- 質問2: 4大管理の優先順位
    (v_lesson_id, 'multiple-choice', '工期・品質・コスト・安全の4大管理において、現場型プロジェクトで最も優先すべきはどれですか？',
     ARRAY['工期: 納期遅延は顧客との信頼関係を損ない、ペナルティや機会損失が発生するため最優先',
           '品質: 品質不良は瑕疵対応や訴訟リスクにつながり、企業の信用を失墜させるため最優先',
           '安全: 労働災害は人命に関わり、プロジェクト中断・企業の社会的責任が問われるため絶対に譲れない',
           'コスト: 利益が出なければ企業経営が成り立たず、次のプロジェクトができなくなるため最優先'],
     ARRAY['安全: 労働災害は人命に関わり、プロジェクト中断・企業の社会的責任が問われるため絶対に譲れない'],
     'A、B、Dはすべて重要ですが、Cの安全が絶対的な最優先です。工期・品質・コストは「トレードオフ」の対象であり、状況によって優先順位が変わりますが、安全だけは「譲れない絶対条件」です。労働災害は①人命に関わる、②プロジェクト中断、③企業の信用失墜・行政処分、④訴訟リスク、と取り返しのつかない結果を招きます。現場の鉄則は「安全第一、品質第二、工期第三」です。工期が遅れても取り返せますが、人命は取り返せません。',
     2, NOW()),

    -- 質問3: トレードオフの理解
    (v_lesson_id, 'multiple-choice', '工期が2週間遅延しそうな状況で、納期を守るための対策として最も適切なのはどれですか？',
     ARRAY['残業・休日出勤を増やし、短期間で集中的に作業を進めて遅れを取り戻す',
           '安価な資材や経験の浅い作業員を投入してコストを抑えつつ、作業量を増やす',
           '工程を見直してクリティカルパスを特定し、後工程に影響しない部分を調整、または顧客と納期再交渉を検討する',
           '品質検査を簡素化し、検査時間を短縮して工期を圧縮する'],
     ARRAY['工程を見直してクリティカルパスを特定し、後工程に影響しない部分を調整、または顧客と納期再交渉を検討する'],
     'Aの残業増は短期的には有効ですが、コスト増・疲労による安全リスク増・品質低下を招きます。Bの安価な資材・未熟な作業員投入は品質低下と作業効率低下（結果的に工期延長）のリスクが高いです。Dの品質検査簡素化は、品質不良を見逃し、後の瑕疵対応で更なる工期・コスト増を招きます。Cが正解で、まず「どこが本当にクリティカルか」を見極め、影響の少ない部分で調整します。それでも困難なら、顧客と誠実に交渉し、現実的な納期を再設定する方が、品質・安全を犠牲にするよりリスクが低いです。',
     3, NOW()),

    -- 質問4: 計画の重要性
    (v_lesson_id, 'multiple-answer', '現場型プロジェクトで「計画の精度」を高めるために有効な手法はどれですか？（複数選択）',
     ARRAY['過去の類似案件の実績データ（工期・原価・歩掛かり）を参考に、現実的な見積もりを行う',
           '現地調査を入念に実施し、図面だけでは分からない現場条件（地盤・既存設備・搬入経路）を把握する',
           '最新の工法や未経験の技術を積極的に採用し、工期短縮とコスト削減を図る',
           '工期・コストに10%程度のコンティンジェンシー（予備）を確保し、想定外の事態に備える'],
     ARRAY['過去の類似案件の実績データ（工期・原価・歩掛かり）を参考に、現実的な見積もりを行う', '現地調査を入念に実施し、図面だけでは分からない現場条件（地盤・既存設備・搬入経路）を把握する', '工期・コストに10%程度のコンティンジェンシー（予備）を確保し、想定外の事態に備える'],
     'A、B、Dが正解です。Aの過去実績活用は、現実的な見積もりの基礎です。Bの現地調査は、図面だけでは分からない現場特有の条件（軟弱地盤、既存配管の位置、搬入経路の狭さ等）を把握し、想定外を減らします。Dのコンティンジェンシーは、不確実性への備えとして必須です。Cは誤りで、未経験の技術は「リスク」であり、計画精度を下げます。工期短縮・コスト削減は魅力的ですが、技術的な不確実性が高く、トラブル発生時の対応に時間がかかります。新技術は小規模案件で試してから、大規模案件に適用すべきです。',
     4, NOW()),

    -- 質問5: 現場マネジメントの成功要因
    (v_lesson_id, 'multiple-choice', '現場型プロジェクトで「問題の早期発見・迅速な対応」を実現するために最も重要なのはどれですか？',
     ARRAY['詳細な計画を立て、計画通りに進めることで問題発生を未然に防ぐ',
           '経験豊富なベテラン作業員を配置し、彼らの勘と経験で問題を察知してもらう',
           '進捗・品質・安全を見える化し、日々の現場巡回と定例会議で状況を共有、異常を即座に検知する仕組みを作る',
           '問題が発生したら速やかに経営層にエスカレーションし、トップダウンで意思決定する'],
     ARRAY['進捗・品質・安全を見える化し、日々の現場巡回と定例会議で状況を共有、異常を即座に検知する仕組みを作る'],
     'Aの計画重視は重要ですが、現場は計画通りにいかないことが前提であり、問題発生を完全に防ぐことは不可能です。Bのベテラン依存は属人化を招き、ベテランがいないと対応できなくなります。Dの経営層エスカレーションは意思決定が遅く、現場は待てません（小さな問題が大きくなる）。Cが正解で、「見える化」により全員が現状を把握し、「日々の巡回・定例会議」で異常を早期検知、「現場での即時対応」が可能になります。現場マネジメントの本質は「問題を隠さず、早く見つけて、素早く対処する」ことです。',
     5, NOW());

END $$;
