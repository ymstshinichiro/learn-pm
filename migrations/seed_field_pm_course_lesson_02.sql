-- 現場型プロジェクトマネジメントコース: レッスン2
-- 工期・品質・コスト・安全 ― 4大管理の関係性を理解する

DO $$
DECLARE
  v_course_id INT;
  v_lesson_id INT;
BEGIN
  -- コースIDを取得
  SELECT id INTO v_course_id FROM courses WHERE slug = 'field-pm';

  -- レッスン2を挿入
  INSERT INTO lessons (course_id, slug, title, content, "order", created_at)
  VALUES (
    v_course_id,
    'four-management-balance',
    '工期・品質・コスト・安全 ― 4大管理の関係性を理解する',
    $CONTENT$# 工期・品質・コスト・安全 ― 4大管理の関係性を理解する

## 📋 このレッスンで学ぶこと

現場型プロジェクトマネジメントの核心は、工期・品質・コスト・安全の4つをバランスよくマネジメントすることです。本レッスンでは、4大管理の相互関係、トレードオフの本質、そして状況に応じた最適なバランスの取り方を深く学びます。

---

## 🎯 4大管理の相互関係

### トレードオフの構造

4つの管理要素は、互いに影響し合う「トレードオフ関係」にあります。

```
        安全（譲れない絶対条件）
           ↓
    [品質] ⇄ [工期] ⇄ [コスト]

一つを改善すると、他が悪化する関係
```

#### 典型的なトレードオフ例

| アクション | プラス効果 | マイナス効果 |
|----------|----------|------------|
| **工期短縮** | 早期納品、機会損失回避 | コスト増（残業代）、安全リスク増、品質低下リスク |
| **品質向上** | 顧客満足度UP、瑕疵減少 | 工期延長（検査・手直し）、コスト増（高品質資材） |
| **コスト削減** | 利益率向上 | 品質低下リスク（安価資材）、工期延長（効率低下） |
| **安全強化** | 災害ゼロ、企業信用維持 | 工期延長（安全教育・対策時間）、コスト増（安全設備） |

### 制約理論（Theory of Constraints）

プロジェクトの成否は、**最も制約が厳しい要素（ボトルネック）**で決まります。

**例**:
```
【病院建設プロジェクト】
- 工期: 開院日は6ヶ月後調整可能（余裕あり）
- 品質: 医療施設のため妥協不可（最大制約）
- コスト: 予算は確保済み（余裕あり）
- 安全: 絶対条件

→ ボトルネックは「品質」
→ 品質確保のために工期・コストを投入する戦略が正解
```

---

## 💰 コスト管理の深掘り

### コストの種類

| コスト分類 | 内容 | 例 |
|----------|------|---|
| **直接費** | プロジェクトに直接紐づくコスト | 材料費、労務費、外注費、機械損料 |
| **間接費** | 複数プロジェクトで共有されるコスト | 現場事務所費、共通仮設費、監督者人件費 |
| **固定費** | 作業量に関係なく発生 | 現場事務所リース、保険料 |
| **変動費** | 作業量に比例して発生 | 材料費、作業員日当 |

### 原価管理の実践

#### 実行予算の構造

```
【実行予算の例: 小規模改修工事】
売上高: 5,000万円

直接費:
  材料費: 1,500万円
  労務費: 1,200万円
  外注費: 1,000万円
  機械費: 300万円
  小計: 4,000万円

間接費:
  現場管理費: 300万円
  一般管理費: 200万円
  小計: 500万円

原価合計: 4,500万円
粗利益: 500万円（粗利率10%）
```

#### コストオーバーランの主な原因

1. **見積もりの甘さ**: 過去実績を無視した楽観的積算
2. **手戻り**: 品質不良・設計変更による再施工
3. **資材価格高騰**: 原油価格・為替変動の影響
4. **工期延長**: 天候不良・トラブルによる長期化
5. **スコープクリープ**: 顧客要求の追加（有償化漏れ）

### コスト削減の正しいアプローチ

#### 悪いコスト削減（品質・安全を犠牲）

❌ **やってはいけない例**:
- 安価だが品質の劣る資材を使用
- 経験の浅い作業員を大量投入
- 安全対策（足場・保護具）の簡素化
- 検査の省略・簡素化

#### 良いコスト削減（工夫による効率化）

✅ **推奨される例**:
- 工法の見直し（プレハブ化、ユニット化）
- 資材の一括発注による値引き交渉
- 作業の標準化による効率向上
- 無駄な待ち時間の削減（工程最適化）
- デジタルツールによる管理効率化

---

## ⏱️ 工期管理の深掘り

### クリティカルパス法（CPM）

プロジェクト全体の工期を決定する「最長経路」がクリティカルパスです。

```
【簡易工程例】
A: 基礎工事（10日） → B: 躯体工事（20日） → C: 内装工事（15日）
                    → D: 外構工事（10日） →

クリティカルパス: A → B → C（合計45日）
Dは並行作業可能で、クリティカルパス外

※ Bが1日遅れると、全体が1日遅れる
※ Dが1日遅れても、全体には影響しない（フロート5日）
```

### 工期短縮の手法

| 手法 | 説明 | 効果 | リスク |
|-----|------|------|--------|
| **ファストトラック** | 本来順序作業を並行化 | 大幅短縮 | 手戻りリスク大 |
| **クラッシング** | リソース追加で加速 | 短縮可能 | コスト増大 |
| **工法変更** | 効率的な工法に変更 | 短縮+コスト減も | 技術リスク |
| **作業時間延長** | 残業・休日出勤 | 短縮可能 | 疲労・安全リスク |

#### ファストトラックの例

```
【通常】
設計完了 → 承認 → 施工開始

【ファストトラック】
基本設計完了 → 先行施工（基礎）
  ↓
詳細設計中 → 並行施工（躯体）

メリット: 工期大幅短縮
リスク: 詳細設計変更時に手戻り発生
```

---

## 🏅 品質管理の深掘り

### 品質の定義

**品質とは**: 「顧客要求を満たす度合い」

| 品質の側面 | 説明 | 評価方法 |
|----------|------|---------|
| **設計品質** | 設計仕様の妥当性 | 設計レビュー、顧客確認 |
| **適合品質** | 設計通りに作られているか | 検査、試験 |
| **使用品質** | 実際の使用に耐えるか | 性能試験、耐久試験 |

### QC（品質管理）とQA（品質保証）

| 用語 | 意味 | 活動例 |
|-----|------|--------|
| **QC** (Quality Control) | 品質を管理する活動 | 検査、測定、不良品の選別 |
| **QA** (Quality Assurance) | 品質を保証する仕組み | 標準化、プロセス改善、予防措置 |

**QCは対症療法、QAは予防医療**

### 品質コスト

品質には「見えるコスト」と「見えないコスト」があります。

```
【適合コスト（品質確保のコスト）】
- 予防コスト: 標準化、教育訓練、設計レビュー
- 評価コスト: 検査、試験、測定機器

【不適合コスト（品質不良のコスト）】
- 内部失敗コスト: 手戻り、スクラップ、再検査
- 外部失敗コスト: 瑕疵対応、クレーム処理、信用失墜

※ 外部失敗コストは内部失敗コストの10倍以上
```

**教訓**: 事前の品質確保（適合コスト）は、事後の不良対応（不適合コスト）より圧倒的に安い

---

## 🦺 安全管理の深掘り

### 安全管理の段階

| 段階 | 内容 | 手法 |
|-----|------|------|
| **1. リスク特定** | 危険源の洗い出し | リスクアセスメント、KYT |
| **2. リスク評価** | 発生確率と影響度の評価 | リスクマトリクス |
| **3. リスク対策** | 対策の実施 | 安全設備、教育、手順書 |
| **4. モニタリング** | 継続的な監視 | 安全パトロール、ヒヤリハット |

### ハインリッヒの法則

```
重大災害 1件の背後には...

軽微な事故: 29件
ヒヤリハット: 300件

※ 重大災害を防ぐには、ヒヤリハットを見逃さない
```

### 安全対策の階層（優先順位）

```
【優先度高】
1. 危険源の除去（本質的安全）
   例: 高所作業をなくす（地上作業に変更）

2. 工学的対策（設備で防ぐ）
   例: 安全柵、カバー、インターロック

3. 管理的対策（ルールで防ぐ）
   例: 作業手順書、立入禁止、資格者限定

4. 個人用保護具（最後の砦）
   例: ヘルメット、安全帯、保護メガネ
【優先度低】

※ 保護具だけに頼るのは最も脆弱な対策
```

---

## ⚖️ 4大管理のバランス戦略

### シナリオ別の優先順位

#### シナリオ1: 商業施設のオープン日が確定

```
状況: テナント契約・広告出稿済み、遅延不可
優先順位: 安全 > 工期 >> コスト > 品質

戦略:
- 工期厳守のため、クラッシング（人員増）許容
- コストオーバーは10%まで許容
- 品質は最低限の仕様を満たせばOK（過剰品質不要）
- 安全は絶対に犠牲にしない
```

#### シナリオ2: 公共インフラ（橋梁・トンネル）

```
状況: 長期使用、品質不良は重大事故につながる
優先順位: 安全 > 品質 >> 工期 > コスト

戦略:
- 品質妥協は一切しない（100年の耐久性）
- 工期は余裕を持たせ、十分な検査時間を確保
- コストは適正品質確保のために必要額を投入
```

#### シナリオ3: 競争入札の定型案件

```
状況: 低価格が受注条件、利益確保が必須
優先順位: 安全 > コスト >> 品質 ≒ 工期

戦略:
- コスト管理を最優先、原価低減の工夫
- 品質は仕様を満たす最低限（過剰品質は排除）
- 工期は標準的、無理な短縮はしない
```

### 優先順位の決め方

**決定要因**:
1. **契約条件**: ペナルティ条項の有無・内容
2. **顧客の重視点**: 何を最も気にしているか
3. **プロジェクトの性質**: 初物か定型か
4. **外部環境**: 市況、天候、社会情勢

**決定プロセス**:
```
ステップ1: 安全は絶対条件として確保
ステップ2: 工期・品質・コストで最も制約が厳しいものを特定
ステップ3: トレードオフを明示し、ステークホルダーと合意
ステップ4: 定期的にレビューし、状況変化に応じて再調整
```

---

## 📊 4大管理のKPI設計

### バランススコアカード

| 観点 | KPI | 目標値 | 測定頻度 |
|-----|-----|--------|---------|
| **工期** | 工程達成率 | 95%以上 | 週次 |
| **工期** | クリティカルパス遅延日数 | 0日 | 日次 |
| **品質** | 検査合格率 | 98%以上 | 工程ごと |
| **品質** | 手戻り率 | 5%以下 | 月次 |
| **コスト** | 原価率 | 90%以下 | 月次 |
| **コスト** | 予算差異 | ±5%以内 | 月次 |
| **安全** | 無災害日数 | 連続記録更新 | 日次 |
| **安全** | ヒヤリハット報告件数 | 月10件以上 | 月次 |

**注意**: ヒヤリハットは「多い方が良い」（隠さず報告する文化）

---

## ⚠️ よくある失敗パターン

### 失敗パターン1: 優先順位が曖昧

**症状**: 現場が混乱、判断が遅れる、責任の押し付け合い

**原因**: 「全部重要」と言って優先順位を決めない

**対策**: プロジェクト開始時に明確に優先順位を決定し、全員に共有

### 失敗パターン2: 安全を犠牲にする

**症状**: 労働災害発生、工事中断、企業の信用失墜

**原因**: 工期優先で安全対策を省略

**対策**: 「安全は絶対条件」を徹底、工期より安全を優先

### 失敗パターン3: 短期的なコスト削減

**症状**: 品質不良、手戻り、結果的にコスト増

**原因**: 目先のコスト削減で安価資材・未熟作業員を投入

**対策**: ライフサイクルコストで考える、品質確保が長期的なコスト削減

---

## 🎓 まとめ

4大管理のバランスは、プロジェクトごとに異なります。

### 成功のための5つのポイント

1. **安全は絶対条件**: 何があっても安全は譲らない
2. **優先順位の明確化**: 工期・品質・コストの優先順位を決め、共有
3. **トレードオフの可視化**: 一つを改善すると他に何が起きるかを明示
4. **データに基づく判断**: KPIを設定し、定量的にモニタリング
5. **柔軟な見直し**: 状況変化に応じて優先順位を再調整

完璧なバランスは存在しません。状況に応じた「最適解」を見つけ、チーム全体で共有することが、現場マネージャーの腕の見せ所です。
$CONTENT$,
    2,
    NOW()
  ) RETURNING id INTO v_lesson_id;

  -- レッスン2の質問を挿入
  INSERT INTO questions (lesson_id, type, question, options, correct_answer, explanation, "order", created_at)
  VALUES
    -- 質問1: トレードオフの本質理解
    (v_lesson_id, 'multiple-choice', '「工期を2週間短縮したい」という要求に対し、最も適切なマネジメント対応はどれですか？',
     ARRAY['クラッシング（人員増強）で対応し、残業・休日出勤を増やして工期短縮を実現する',
           '安価な資材や経験の浅い作業員を投入し、コストを抑えつつ作業量を増やす',
           '工期短縮のトレードオフ（コスト増・安全リスク増・品質リスク）を定量的に示し、ステークホルダーと優先順位を合意する',
           'クリティカルパス上の作業のみ短縮し、並行作業は現状維持で全体工期を圧縮する'],
     ARRAY['工期短縮のトレードオフ（コスト増・安全リスク増・品質リスク）を定量的に示し、ステークホルダーと優先順位を合意する'],
     'Aのクラッシングは工期短縮には有効ですが、コスト増・疲労による安全リスク増を伴います。判断せずに実施するのは危険です。Bは品質低下と効率低下（結果的に工期延長）のリスクが高いです。Dのクリティカルパス短縮は技術的には正しいですが、トレードオフの検討なしに進めるべきではありません。Cが正解で、まず「工期短縮の代償」を明確にし（コスト○○万円増、安全リスク△△、品質リスク□□）、ステークホルダーと「本当に短縮すべきか」「どこまで許容するか」を合意します。マネージャーの役割は、トレードオフを可視化し、意思決定をサポートすることです。',
     1, NOW()),

    -- 質問2: コスト削減の正しいアプローチ
    (v_lesson_id, 'multiple-choice', '原価率が予算を超過しそうな状況で、最も適切なコスト削減策はどれですか？',
     ARRAY['安価だが品質基準を満たす資材に変更し、材料費を10%削減する',
           '検査工程を簡素化し、検査時間とコストを削減する',
           '工法を見直し、プレハブ化やユニット化により作業効率を向上させてコストを削減する',
           '経験の浅い作業員を増やし、単価の高いベテランを減らして労務費を削減する'],
     ARRAY['工法を見直し、プレハブ化やユニット化により作業効率を向上させてコストを削減する'],
     'Aの安価資材は一見合理的ですが、品質基準を「ギリギリ満たす」レベルでは、施工トラブルや耐久性不足のリスクがあり、長期的にはコスト増になる可能性があります。Bの検査簡素化は品質不良を見逃し、外部失敗コスト（瑕疵対応）が発生します。Dの未熟作業員増は作業効率が低く、ミス・手戻りが増えて結果的にコスト増です。Cが正解で、工法改善（プレハブ化、ユニット化）は品質・安全を犠牲にせず、効率向上によりコスト削減を実現します。コスト削減の本質は「工夫による効率化」であり、品質・安全を犠牲にする削減は禁物です。',
     2, NOW()),

    -- 質問3: 品質コストの理解
    (v_lesson_id, 'multiple-choice', '品質管理において「事前の品質確保」が「事後の不良対応」より優れている理由として最も適切なのはどれですか？',
     ARRAY['事前の検査・教育は作業員のモチベーションを高め、品質意識が向上するから',
           '外部失敗コスト（顧客への瑕疵対応）は内部失敗コスト（社内での手戻り）の10倍以上であり、予防コストは圧倒的に安いから',
           '事前の品質確保は顧客との信頼関係を構築し、次回受注につながるから',
           '事前に品質を確保すれば、検査工程を省略できてコスト削減につながるから'],
     ARRAY['外部失敗コスト（顧客への瑕疵対応）は内部失敗コスト（社内での手戻り）の10倍以上であり、予防コストは圧倒的に安いから'],
     'A、Cは副次的なメリットですが、本質ではありません。Dは誤りで、事前品質確保と検査省略は別の話であり、検査は必須です。Bが正解で、品質不良が「外部」（顧客）に流出すると、瑕疵対応・クレーム処理・信用失墜・訴訟リスクなど、莫大なコストが発生します（外部失敗コスト）。これに対し「内部」で発見すれば手戻りコストで済み、さらに「予防」（標準化、教育、設計レビュー）はもっと安価です。品質管理の鉄則は「予防 > 内部発見 > 外部流出（最悪）」の順でコストが跳ね上がることを理解することです。',
     3, NOW()),

    -- 質問4: 安全管理の優先順位
    (v_lesson_id, 'multiple-answer', '労働災害を防ぐための対策として、優先順位が高い（効果的な）ものはどれですか？（複数選択）',
     ARRAY['高所作業を地上作業に変更し、墜落の危険源そのものを除去する（本質的安全化）',
           '安全柵・カバーを設置し、危険箇所に近づけないようにする（工学的対策）',
           'ヘルメット・安全帯などの保護具を全員に配布し、着用を義務付ける（個人用保護具）',
           '作業手順書を整備し、資格者のみが作業できるように制限する（管理的対策）'],
     ARRAY['高所作業を地上作業に変更し、墜落の危険源そのものを除去する（本質的安全化）', '安全柵・カバーを設置し、危険箇所に近づけないようにする（工学的対策）'],
     'A、Bが正解です。安全対策には優先順位があり、「本質的安全（危険源除去）> 工学的対策（設備で防ぐ）> 管理的対策（ルールで防ぐ）> 保護具（最後の砦）」の順です。Aの危険源除去は最も効果的で、高所作業自体をなくせば墜落リスクはゼロになります。Bの安全柵・カバーは物理的に危険に近づけないため、人間のミスに左右されず効果的です。Cの保護具、Dの管理的対策も重要ですが、「人間が正しく使う・守る」前提であり、ミスや違反があれば無効化します。安全管理の本質は「人に頼らない仕組み」を優先することです。',
     4, NOW()),

    -- 質問5: 4大管理の優先順位決定
    (v_lesson_id, 'multiple-choice', '新規の商業施設改装プロジェクトで、オープン日が広告済みで変更不可、予算は余裕あり、品質は標準仕様でOKという状況。この場合の優先順位として最も適切なのはどれですか？',
     ARRAY['安全 > 品質 > 工期 > コスト（品質を最優先し、顧客満足を最大化）',
           '安全 > 工期 > コスト > 品質（オープン日厳守、予算内で標準品質確保）',
           '安全 > コスト > 品質 > 工期（利益確保を優先し、工期は多少遅れてもOK）',
           '工期 > 安全 > 品質 > コスト（オープン日が最優先、安全も重要だが工期優先）'],
     ARRAY['安全 > 工期 > コスト > 品質（オープン日厳守、予算内で標準品質確保）'],
     'Aは品質を過度に優先していますが、問題文で「標準仕様でOK」とあり、過剰品質は不要です。Cはコスト優先ですが、「予算は余裕あり」とあり、利益確保より工期厳守が重要です。Dは工期を安全より優先しており、絶対にNGです（安全は譲れない）。Bが正解で、①安全は絶対条件、②オープン日が広告済みで変更不可のため工期最優先、③予算に余裕があるためコストオーバーは許容範囲、④品質は標準仕様を満たせば良く過剰品質不要、という優先順位です。状況に応じた優先順位の設定が、現場マネジメントの要です。',
     5, NOW());

END $$;
