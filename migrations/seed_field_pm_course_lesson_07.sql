-- 現場型プロジェクトマネジメントコース: レッスン7
-- 外注管理と協力会社との関係構築

DO $$
DECLARE
  v_course_id INT;
  v_lesson_id INT;
BEGIN
  -- コースIDを取得
  SELECT id INTO v_course_id FROM courses WHERE slug = 'field-pm';

  -- レッスン7を挿入
  INSERT INTO lessons (course_id, slug, title, content, "order", created_at)
  VALUES (
    v_course_id,
    'subcontractor-partner-management',
    '外注管理と協力会社との関係構築',
    $CONTENT$# 外注管理と協力会社との関係構築

## 📋 このレッスンで学ぶこと

現場は多数の協力会社（外注）との協業で成り立っています。本レッスンでは、協力会社の選定、契約管理、日々の調整、そして長期的なパートナーシップ構築の実践手法を学びます。

---

## 🎯 外注管理の基本

### なぜ外注するのか

| 理由 | 内容 |
|-----|------|
| **専門性** | 電気・配管など専門技術が必要 |
| **変動対応** | 繁閑に応じた柔軟なリソース確保 |
| **コスト** | 固定費（正社員）より変動費で調整 |
| **リスク分散** | 労務管理リスクの分散 |

### 外注のリスク

| リスク | 内容 |
|-------|------|
| **品質ばらつき** | 会社により技術力に差 |
| **スケジュール** | 複数現場掛け持ちで遅延 |
| **コミュニケーション** | 情報伝達の不足・誤解 |
| **責任範囲** | 取り合い部分での責任の曖昧さ |

---

## 🔍 協力会社の選定

### 選定基準

| 評価項目 | 確認ポイント | 重要度 |
|---------|------------|--------|
| **技術力** | 施工実績、有資格者数、施工品質 | ⭐⭐⭐⭐⭐ |
| **信頼性** | 納期遵守率、トラブル対応 | ⭐⭐⭐⭐⭐ |
| **価格** | 見積単価、支払条件 | ⭐⭐⭐⭐ |
| **安全管理** | 労災発生率、安全教育体制 | ⭐⭐⭐⭐⭐ |
| **コミュニケーション** | 報告の質、連絡の速さ | ⭐⭐⭐⭐ |
| **対応力** | 急な依頼への対応、柔軟性 | ⭐⭐⭐ |

### 協力会社データベースの構築

```
【登録情報】
- 会社情報（名称、所在地、連絡先）
- 業種・得意分野
- 過去の取引実績（件数、金額）
- 評価履歴（品質、工期、安全、コスト）
- 有資格者リスト
- 保険加入状況
```

**活用**:
- 案件に応じた最適な協力会社選定
- 評価に基づく継続取引判断
- 新規開拓の優先順位

---

## 📝 契約と発注

### 契約の種類

| 契約形態 | 内容 | メリット | デメリット |
|---------|------|---------|----------|
| **一式請負** | 成果物を一式で発注 | 範囲明確、管理容易 | 柔軟性低い |
| **単価請負** | 単価×実数量で精算 | 柔軟、数量変動対応 | 数量管理必要 |
| **常用** | 人工（人×日）で精算 | 変動に強い | 成果責任曖昧 |

### 発注時の確認事項

**発注書に明記すべき内容**:
```
1. 工事名・発注者・受注者
2. 工事場所
3. 工事内容（仕様、数量、図面参照）
4. 工期（着手日、完了日）
5. 請負金額・支払条件
6. 品質基準・検査方法
7. 安全管理責任
8. 変更時の手続き
9. 瑕疵担保責任
```

**重要**: 口約束は厳禁。すべて文書化。

---

## 🤝 日々の調整と管理

### 工程調整

**課題**: 複数の協力会社の作業が連鎖するため、調整が複雑

```
【建築現場の例】
基礎業者 → 躯体業者 → 電気業者 ─┐
                      → 配管業者 ─┤→ 内装業者
                      → 空調業者 ─┘
```

**調整のポイント**:
- 週次工程会議で全業者の進捗を共有
- 前工程の遅延を早期に検知、後工程に連絡
- 取り合い部分（責任境界）を明確化

### 品質管理

**協力会社の品質確保**:
1. **事前調整**: 施工前に図面読み合わせ、仕様確認
2. **工程内検査**: 次工程に渡す前に検査・承認
3. **立会検査**: 重要箇所は発注者が立会
4. **是正指示**: 不具合は即座に指摘、是正確認

### 安全管理

**協力会社の安全責任**:
- 元請（発注者）が統括安全衛生責任者
- 協力会社は自社の作業員の安全管理責任

**安全管理の実践**:
```
朝礼: 全業者合同で本日の作業・注意事項共有
安全パトロール: 元請が全業者の作業を巡回
是正指示: 不安全な状態・行動は即座に指摘
```

---

## 💰 支払管理

### 出来高確認

**月次の出来高査定**:
```
1. 協力会社が出来高報告書を提出
2. 元請が現場確認、出来高を査定
3. 合意した出来高で請求書発行
4. 翌月末払い（支払条件による）
```

### 追加工事の取り扱い

**追加発生時の手順**:
```
1. 協力会社が追加工事を報告
2. 元請が内容・数量を確認
3. 見積もり提出・承認
4. 発注書（追加分）発行
5. 施工・検収・支払
```

**重要**: 事後承認は避ける。事前合意が原則。

---

## 📊 協力会社の評価

### 評価制度の目的

1. **継続取引の判断**: 優良業者との関係強化
2. **改善の促進**: フィードバックによる品質向上
3. **公平性の確保**: 客観的な基準で評価

### 評価項目と配点例

```
【協力会社評価表】

項目              配点   評価  得点
────────────────────────────
品質（施工精度）    25点   A    23点
工期（納期遵守）    25点   B    20点
安全（無災害）      25点   A    25点
コスト（予算内）    15点   B    12点
コミュニケーション  10点   A    10点
────────────────────────────
合計              100点         90点

評価ランク:
S: 95点以上（特に優秀）
A: 85-94点（優秀）
B: 70-84点（普通）
C: 60-69点（要改善）
D: 60点未満（取引見直し）
```

### 評価のフィードバック

**年次または案件終了時**:
- 評価結果を協力会社に通知
- 良い点を称賛、改善点を指摘
- 次回への期待を伝達

---

## 🌟 長期的なパートナーシップ

### Win-Winの関係構築

**元請のメリット**:
- 安定した品質・工期
- 優先的な対応
- コスト削減の提案

**協力会社のメリット**:
- 安定した受注
- 計画的な人員・資材手配
- 技術向上の機会

### パートナーシップ施策

| 施策 | 内容 |
|-----|------|
| **継続発注** | 年間契約、定期的な発注 |
| **情報共有** | 中長期の計画を事前共有 |
| **技術支援** | 新工法の教育、資格取得支援 |
| **表彰制度** | 優良業者を表彰、社内外に公表 |
| **早期支払** | 資金繰り支援、手形期間短縮 |

### 協力会社との定例会

**四半期に一度の意見交換**:
```
議題:
1. 過去3ヶ月の振り返り
2. 良かった点、改善点
3. 今後の案件予定
4. 協力会社からの要望・提案
5. 技術動向の情報交換
```

---

## ⚠️ よくある失敗パターン

### 失敗パターン1: 価格だけで選定

**症状**: 安い業者を選んだが、品質不良・遅延頻発

**原因**: 技術力・信頼性を軽視

**対策**: 総合評価、過去実績重視

### 失敗パターン2: 丸投げ

**症状**: 協力会社に任せきりで管理不足、問題多発

**原因**: 「プロだから大丈夫」という過信

**対策**: 定期確認、工程内検査の徹底

### 失敗パターン3: 一方的な関係

**症状**: 協力会社が離れていく、繁忙期に確保できない

**原因**: 元請の都合だけ押し付け、Win-Winでない

**対策**: 対等なパートナーとして尊重、継続的な関係構築

---

## 🎓 まとめ

協力会社は「外部の人」ではなく、「チームの一員」です。

### 成功のための5つのポイント

1. **適切な選定**: 技術力・信頼性を重視した総合評価
2. **明確な契約**: 範囲・品質・工期を文書化
3. **日々の調整**: 工程会議、検査、安全管理
4. **公平な評価**: 客観的基準でフィードバック
5. **長期的パートナーシップ**: Win-Winの関係構築

「良い協力会社との関係は、プロジェクト成功の要」— 信頼と尊重が基盤です。
$CONTENT$,
    7,
    NOW()
  ) RETURNING id INTO v_lesson_id;

  -- レッスン7の質問を挿入
  INSERT INTO questions (lesson_id, type, question, options, correct_answer, explanation, "order", created_at)
  VALUES
    (v_lesson_id, 'multiple-choice', '新規の協力会社を選定する際、最も重視すべき基準はどれですか？',
     ARRAY['見積単価が最も安く、コスト削減効果が大きい会社',
           '過去の施工実績、技術力、安全管理体制を総合的に評価し、信頼できる会社',
           '大手で知名度が高く、多くの作業員を抱えている会社',
           '以前取引があり、担当者と個人的に親しい会社'],
     ARRAY['過去の施工実績、技術力、安全管理体制を総合的に評価し、信頼できる会社'],
     'Aの単価最優先は、品質不良・遅延・安全問題のリスクが高いです。Cの大手・知名度は安心感はありますが、実際にアサインされる作業員の技術力とは別問題です。Dの個人的関係は一つの要素ですが、客観的な評価基準ではありません。Bが正解で、協力会社選定は「技術力」「過去実績」「安全管理体制」「納期遵守率」を総合的に評価すべきです。価格は重要ですが、安さだけで選ぶと後のトラブル対応コストが膨らみます。協力会社選定の原則は「総合評価、過去実績重視」です。',
     1, NOW()),

    (v_lesson_id, 'multiple-choice', '協力会社への発注時、最も重要なのはどれですか？',
     ARRAY['信頼関係があるため、詳細は口頭で伝え、発注書は簡易的なもので済ませる',
           '工事内容・仕様・工期・金額・品質基準・変更時の手続きをすべて文書化した発注書を発行する',
           'メールで工事内容を伝え、返信をもって発注とする',
           '過去の案件と同じ内容なら、前回の発注書をコピーして日付だけ変更する'],
     ARRAY['工事内容・仕様・工期・金額・品質基準・変更時の手続きをすべて文書化した発注書を発行する'],
     'Aの口頭伝達は、後で「言った・言わない」のトラブルになります。信頼関係があっても文書化は必須です。Cのメール発注は記録は残りますが、正式な契約書としては不十分（署名・捺印がない）です。Dの前回コピーは、今回固有の条件（仕様変更、特記事項）が反映されず、トラブルの元です。Bが正解で、発注時は「工事内容」「仕様（図面参照）」「工期」「金額」「品質基準」「検査方法」「変更時の手続き」「瑕疵担保責任」をすべて文書化した正式な発注書を発行します。契約の鉄則は「文書化」です。',
     2, NOW()),

    (v_lesson_id, 'multiple-choice', '複数の協力会社が関わる現場で、電気業者の遅延により内装業者の着手が遅れそうな状況。最も適切な対応はどれですか？',
     ARRAY['電気業者に遅延の責任を取らせ、内装業者への補償を負担させる',
           '週次工程会議で電気業者の遅延を共有し、内装業者に状況を説明、着手日を再調整する',
           '内装業者には何も伝えず、電気業者に急がせて間に合わせる',
           '電気工事と内装工事を並行作業させ、工期を短縮する'],
     ARRAY['週次工程会議で電気業者の遅延を共有し、内装業者に状況を説明、着手日を再調整する'],
     'Aの責任追及・補償は、問題解決にならず、関係悪化を招きます（元請の工程管理責任もあります）。Cの情報隠蔽は、内装業者が予定通り準備して待機し、無駄なコストが発生します。Dの並行作業は、取り合い（配線と内装の干渉）でトラブルが起き、手戻りが発生します。Bが正解で、工程会議で遅延を共有し、関係者全員に状況を説明、内装業者には着手日を再調整してもらいます。透明性のある情報共有により、協力会社も納得し、代替案（他現場の調整等）を考えられます。工程管理の鉄則は「早期共有、迅速調整」です。',
     3, NOW()),

    (v_lesson_id, 'multiple-answer', '協力会社との長期的なパートナーシップを構築するために有効な施策はどれですか？（複数選択）',
     ARRAY['年間契約や定期的な発注により、協力会社に安定した仕事を提供する',
           '中長期の案件計画を事前に共有し、協力会社が計画的に人員・資材を手配できるようにする',
           '評価制度で優良業者を表彰し、技術向上の支援（教育・資格取得）も行う',
           '常に最安値の業者を選定し、競争原理で協力会社の努力を促す'],
     ARRAY['年間契約や定期的な発注により、協力会社に安定した仕事を提供する', '中長期の案件計画を事前に共有し、協力会社が計画的に人員・資材を手配できるようにする', '評価制度で優良業者を表彰し、技術向上の支援（教育・資格取得）も行う'],
     'A、B、Cが正解です。Aの継続発注は協力会社に安定収入をもたらし、元請への優先対応・品質向上につながります。Bの計画共有により、協力会社は計画的に準備でき、繁忙期の確保もスムーズです。Cの表彰・技術支援は、協力会社のモチベーション向上と技術力強化を促します。Dは誤りで、常に最安値選定は「使い捨て」の関係であり、協力会社は長期的に付き合う価値を感じず、繁忙期に確保できなくなります。パートナーシップの本質は「Win-Win」であり、元請も協力会社も利益を得る関係です。',
     4, NOW()),

    (v_lesson_id, 'multiple-choice', '協力会社から「追加で配管ルートを変更したい」との提案があった。最も適切な対応はどれですか？',
     ARRAY['協力会社の提案を尊重し、即座に承認して変更を進める',
           '変更内容を確認し、技術的妥当性・コストへの影響・他業者への影響を評価した上で、承認または却下を判断する',
           '「契約通りに施工するように」と指示し、変更は一切認めない',
           '変更を認めるが、追加費用は一切支払わない条件とする'],
     ARRAY['変更内容を確認し、技術的妥当性・コストへの影響・他業者への影響を評価した上で、承認または却下を判断する'],
     'Aの即座承認は、他業者への影響（配管変更で電気配線も変更必要等）やコスト増を見落とす可能性があります。Cの一切認めないは、合理的な提案（施工性向上、品質向上）も却下することになり、硬直的です。Dの追加費用なしは、協力会社の負担増を強いるもので、今後の関係に悪影響です。Bが正解で、変更提案は①技術的妥当性（品質・安全への影響）、②コストへの影響、③他業者への影響（工程・取り合い）を評価し、総合的に判断します。合理的な提案なら承認し、必要なら追加費用も支払います。変更管理の原則は「評価→判断→文書化」です。',
     5, NOW());

END $$;
